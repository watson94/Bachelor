%-*-coding: utf-8-*-
\chapter{Решение массовой задачи о ближайшем отрезке с помощью диаграммы Вороного}
\label{chapSVD}

В данной главе дается определение диаграммы Вороного и предлагается
решение задачи dist2segments, использующее диаграмму Вороного для
отрезков. Реализацию данного решения можно найти в сборнике библиотек
CGAL \cite{CGAL}.

\section{Диаграмма Вороного для точек}

Для лучшего понимания диаграммы Вороного для отрезков рассмотрим
диаграмму Вороного для точек. Вообще, диаграмма Вороного для точек
является частным случаем диаграммы
Вороного для отрезков, однако она
характерна тем, что может быть представлена РСДС, так как она имеет
линейную структуру.

\subsection{Определение диаграммы Вороного для точек}

Сначала дадим определение локусам (locus). Итак, локусом называется
область точек, обладающая требуемым свойством \cite{PrSh}. Собственно, диаграмма
Вороного для произвольного множества точек -- это представление
построенной системы локусов для каждой точки $p$ данного множества $S$ со
следующим свойством: расстояние от любой точки локуса $q$ до $p$ меньше, чем
до любой точки из $S$ (рис. \ref{pvd}). Диаграмма Вороного связана с триангуляцией Делоне \cite{PrSh, CGAL} следующим
образом: граф Делоне является триангуляцией Делоне в предположении, что
никакие четыре точки из $S$ не лежат на одной окружности.

\drawfigure{pvd}{Диаграмма Вороного}{pvd}

\subsection{Построение диаграммы Вороного для точек}

Существует много способов построения диаграммы Вороного. Можно
доказать, что нижняя оценка сложности построения диаграммы Вороного есть
$O(n \log n)$. Эта оценка достигается, например, через бинарную декомпозицию и
последующую композицию задачи (Divide and Conquer) \cite{PrSh}. Собственно, алгоритм
построения диаграммы Вороного в данной работе рассмотрен не будет, его
можно найти в \cite{PrSh, CGAL}, однако мы рассмотрим подробнее результат работы
алгоритма построения диаграммы Вороного. Итак, на выходе обычно получают
или саму диаграмму, или двойственную ей триангуляцию Делоне (Delaunay
triangulation). Возникает естественный вопрос о представлении результата.
Обычно диаграмма Вороного, если ее необходимо представить явно,
представляется в виде РСДС \cite{PrSh}. Отметим, что локализация точки в РСДС
оценивается в $O(\log n)$, однако, если запросы хорошо кэшируемы, то
локализацию можно проводить и за константное время.

Часто применяют метод локальной модели вычислений. Именно, если
последовательные запросы на решение задачи dist2segments расположены недалеко
друг от друга, то имеет смысл выбрать в качестве стартовой грани локализации
грань, которая была найдена для последнего запроса. Очень часто такая
техника кэширования позволяет проводить локализацию в среднем за $O(1)$, так как
искомая точка оказывается расположенной или на той же грани, что и
предыдущая, или на одной из соседних граней.

\section{Диаграмма Вороного для отрезков}

Для множественного запроса типа dist2segments можно использовать
диаграмму Вороного для отрезков (segment Voronoi diagram, SVD) \cite{SVD} (рис. \ref{svd}).

\drawfigure{svd}{Диаграмма Вороного для отрезков}{svd}

Диаграмма Вороного для отрезков определяется так же, как и диаграмма
Вороного для точек, однако локусы определяются уже для отрезков. Именно,
ячейкой Вороного (гранью) отрезка $s$ называется множество всех точек
плоскости, более близких к $s$, чем к какому-либо другому отрезку $s$ из
множества $S$. На самом деле отличие от диаграммы Вороного для точек очень
существенно -- границы граней (бисекторы) являются кривыми второго
порядка. Как следствие -- практически невозможно хранить диаграмму Вороного
для отрезков в явном виде (в отличие от диаграммы Вороного для точек, для которой существует
представление в виде, например, РСДС).
Однако хранить ее в явном виде зачастую и не требуется: очень часто
хранят триангуляцию Делоне (constrained Delaunay
triangulation, CDT) \cite{CGAL}, двойственную диаграмме Вороного. Это важный момент -- 
по триангулции Делоне диаграмма Вороного восстанавливается
однозначно, хотя это и сопряжено с большими трудозатратами.

Наиболее часто используемая реализация диаграммы Вороного принадлежит Geometry
Factory -- это библиотека коллекции CGAL \cite{CGAL} (segment Voronoi diagram library),
которая, в свою очередь, признана классическим трудом в области
вычислительной геометрии.
Сложность ее построения -- $O(n \log n)$ \cite{CGAL} (хотя в CGAL используется
инкрементальный алгоритм сложности $O(n \log^2 n$)). Локализация точки в диаграмме Вороного --
$O(\log n)$. Однако, применяя технику локальной модели вычислений, можно
добиться оценки сложности запроса $O(1)$.
В библиотеке CGAL данная техника с успехом была реализована, что
позволило существенно сократить время обработки запроса dist2segments.

\section{Решение задачи dist2segments}

На предобработке строится диаграмма Вороного для точек и отрезков.
Сложность в худшем случае $O(n \log n)$. Затем для каждой точки-запроса из $Q$
проводим локализацию в построенной диаграмме Вороного. Сложность в
худшем случае $O(\log n)$, в среднем -- $O(1)$. Получив ячейку Вороного, можно
элементарными вычислениями получить расстояние до соответствующего
отрезка. Сложность в худшем и среднем случае -- $O(1)$.

\section{Анализ полученных результатов}

Итак, первый вариант решения задачи dist2segments требует в худшем и
среднем случаях $O(n)$ памяти. Сложность построения диаграммы Вороного для отрезков
 в худшем случае -- $O(n \log n)$. Локализация точки в ней в худшем случае -- $O(\log n)$, 
возможно решение с кэшированием, которое существенно улучшает результат --
сложность в среднем -- $O(1)$. Собственно, как вариант решения поставленной
задачи он является классическим и общепризнанным, но практика показывает,
что на многих прикладных задачах лучше пользоваться другими методиками,
которые, по сути, изоморфны диаграмме Вороного для отрезков, однако позволяют сократить время 
запроса в среднем в 1.5 раза.
